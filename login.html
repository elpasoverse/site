<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Join the El Paso Verse community. Sign in to access exclusive Western film content, earn PASO, and help build the 1880 frontier.">
    <title>Join the Community | El Paso Verse — 1880 Frontier Portal</title>
    <link rel="canonical" href="https://elpasoverse.com/login.html">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/paso-token.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://elpasoverse.com/login.html">
    <meta property="og:site_name" content="El Paso Verse">
    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Join the Community | El Paso Verse — 1880 Frontier Portal">
    <meta property="og:description" content="Join the El Paso Verse community. Sign in to access exclusive Western film content, earn PASO, and help build the 1880 frontier.">
    <meta property="og:image" content="https://elpasoverse.com/assets/hero-bg.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Join the Community | El Paso Verse">
    <meta name="twitter:description" content="Join the El Paso Verse community. Access exclusive Western film content and help build the 1880 frontier.">
    <meta name="twitter:image" content="https://elpasoverse.com/assets/hero-bg.jpg">

    <!-- Google Fonts - Cinzel for headings -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url('assets/hero-bg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1;
        }

        .login-container {
            position: relative;
            z-index: 2;
            max-width: 450px;
            width: 90%;
            background-color: rgba(245, 230, 211, 0.95);
            padding: 3rem 2.5rem;
            border: 3px solid #8B4513;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            font-family: 'Cinzel', Georgia, serif;
            font-size: 2.5rem;
            color: #3A2820;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .login-header p {
            color: #8B4513;
            font-style: italic;
            margin: 0;
            text-align: center;
        }

        .ornament {
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, transparent, #C9A961, transparent);
            margin: 1.5rem auto;
            position: relative;
        }

        .ornament::after {
            content: '\2605';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: #C9A961;
            font-size: 1rem;
            background-color: #F5E6D3;
            padding: 0 0.5rem;
        }

        /* Auth Mode Toggle */
        .auth-toggle {
            display: flex;
            margin-bottom: 1.5rem;
            border: 2px solid #8B4513;
            border-radius: 0;
        }

        .auth-toggle button {
            flex: 1;
            padding: 0.75rem 1rem;
            background-color: transparent;
            border: none;
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #8B4513;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-toggle button.active {
            background-color: #8B4513;
            color: #F5E6D3;
        }

        .auth-toggle button:hover:not(.active) {
            background-color: rgba(139, 69, 19, 0.1);
        }

        .login-form {
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #3A2820;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-family: Georgia, 'Times New Roman', serif;
            background-color: #fff;
            border: 2px solid #8B4513;
            color: #3A2820;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #C9A961;
        }

        .login-button {
            width: 100%;
            padding: 1rem;
            background-color: #8B4513;
            color: #F5E6D3;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: Georgia, 'Times New Roman', serif;
        }

        .login-button:hover {
            background-color: #C9A961;
            color: #3A2820;
        }

        .login-button:active {
            transform: translateY(1px);
        }

        .login-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        .message {
            display: none;
            padding: 1rem;
            margin-bottom: 1.25rem;
            font-size: 0.9rem;
        }

        .message.error {
            background-color: rgba(139, 69, 19, 0.1);
            border-left: 4px solid #8B4513;
            color: #8B4513;
        }

        .message.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            color: #2E7D32;
        }

        .message.show {
            display: block;
        }

        .forgot-password {
            text-align: center;
            margin-top: 1rem;
        }

        .forgot-password a {
            color: #8B4513;
            text-decoration: none;
            font-size: 0.9rem;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s ease;
            cursor: pointer;
        }

        .forgot-password a:hover {
            border-bottom-color: #C9A961;
        }

        .back-link {
            text-align: center;
            margin-top: 1.5rem;
        }

        .back-link a {
            color: #8B4513;
            text-decoration: none;
            font-size: 0.9rem;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s ease;
        }

        .back-link a:hover {
            border-bottom-color: #C9A961;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background-color: #F5E6D3;
            padding: 2rem;
            border: 3px solid #8B4513;
            max-width: 400px;
            width: 90%;
        }

        .modal h2 {
            font-family: 'Cinzel', Georgia, serif;
            font-size: 1.5rem;
            color: #3A2820;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .modal p {
            color: #3A2820;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .modal-buttons button {
            flex: 1;
            padding: 0.75rem;
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-buttons .btn-primary {
            background-color: #8B4513;
            color: #F5E6D3;
            border: none;
        }

        .modal-buttons .btn-primary:hover {
            background-color: #C9A961;
            color: #3A2820;
        }

        .modal-buttons .btn-secondary {
            background-color: transparent;
            color: #8B4513;
            border: 2px solid #8B4513;
        }

        .modal-buttons .btn-secondary:hover {
            background-color: rgba(139, 69, 19, 0.1);
        }

        /* Hidden form fields */
        .hidden {
            display: none !important;
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1.5rem 0;
            width: 100%;
            height: auto;
            background-color: transparent;
        }

        .divider::before,
        .divider::after {
            content: none;
        }

        .divider span {
            color: #8B4513;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 1rem;
        }

        /* Google Button */
        .google-button {
            width: 100%;
            padding: 0.875rem 1rem;
            background-color: #fff;
            color: #3A2820;
            border: 2px solid #8B4513;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: Georgia, 'Times New Roman', serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .google-button:hover {
            background-color: rgba(139, 69, 19, 0.1);
        }

        .google-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .google-button svg {
            width: 20px;
            height: 20px;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 2rem 1.5rem;
            }

            .login-header h1 {
                font-size: 2rem;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div style="margin-bottom: 1.5rem; text-align: center;">
                <img src="assets/el-paso-verse-logo-black.png" alt="El Paso Verse" style="max-width: 300px; height: auto;">
            </div>
            <h1>Community</h1>
            <div class="ornament"></div>
            <p>Members of the Frontier</p>
        </div>

        <!-- Auth Mode Toggle -->
        <div class="auth-toggle">
            <button type="button" id="signInTab" class="active">Sign In</button>
            <button type="button" id="signUpTab">Sign Up</button>
        </div>

        <!-- Messages -->
        <div class="message error" id="errorMessage"></div>
        <div class="message success" id="successMessage"></div>

        <!-- Sign In Form -->
        <form class="login-form" id="signInForm">
            <div class="form-group">
                <label for="signInEmail">Email</label>
                <input
                    type="email"
                    id="signInEmail"
                    name="email"
                    placeholder="Enter your email"
                    required
                    autocomplete="email"
                >
            </div>

            <div class="form-group">
                <label for="signInPassword">Password</label>
                <input
                    type="password"
                    id="signInPassword"
                    name="password"
                    placeholder="Enter your password"
                    required
                    autocomplete="current-password"
                >
            </div>

            <button type="submit" class="login-button" id="signInButton">
                Enter the Frontier
            </button>

            <div class="forgot-password">
                <a id="forgotPasswordLink">Forgot Password?</a>
            </div>

            <div class="forgot-password hidden" id="resendVerification">
                <a id="resendVerificationLink">Resend verification email</a>
            </div>
        </form>

        <!-- Sign Up Form -->
        <form class="login-form hidden" id="signUpForm">
            <div class="form-group">
                <label for="signUpEmail">Email</label>
                <input
                    type="email"
                    id="signUpEmail"
                    name="email"
                    placeholder="Enter your email"
                    required
                    autocomplete="email"
                >
            </div>

            <div class="form-group">
                <label for="signUpPassword">Password</label>
                <input
                    type="password"
                    id="signUpPassword"
                    name="password"
                    placeholder="Create a password (min. 6 characters)"
                    required
                    minlength="6"
                    autocomplete="new-password"
                >
            </div>

            <div class="form-group">
                <label for="signUpConfirmPassword">Confirm Password</label>
                <input
                    type="password"
                    id="signUpConfirmPassword"
                    name="confirmPassword"
                    placeholder="Confirm your password"
                    required
                    minlength="6"
                    autocomplete="new-password"
                >
            </div>

            <div class="form-group" style="margin-top: 1rem;">
                <label style="display: flex; align-items: flex-start; gap: 0.75rem; cursor: pointer; font-size: 0.85rem; line-height: 1.4;">
                    <input type="checkbox" id="agreeTermsCheckbox" required style="width: 18px; height: 18px; margin-top: 2px; accent-color: #8B4513; cursor: pointer;">
                    <span>I have read and agree to the <a href="#" id="openWaiverLink" style="color: #8B4513; text-decoration: underline;">Participation Intake Waiver &amp; PASO Grant Terms</a></span>
                </label>
            </div>

            <button type="submit" class="login-button" id="signUpButton">
                Join the Frontier
            </button>
        </form>

        <!-- Google Sign In -->
        <div class="divider">
            <span>or</span>
        </div>

        <button type="button" class="google-button" id="googleSignInButton">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Continue with Google
        </button>

        <div class="back-link">
            <a href="index.html">&larr; Back to Main Site</a>
        </div>
    </div>

    <!-- PASO Grant Modal -->
    <div class="modal-overlay" id="grantModal">
        <div class="modal" style="max-width: 550px; text-align: center;">
            <div style="margin-bottom: 1.5rem;">
                <img src="assets/paso-token.png" alt="PASO" style="width: 70px; height: 70px;">
            </div>

            <h2 style="font-family: 'Cinzel', Georgia, serif; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; color: #3A2820;">PASO Participation Grant</h2>

            <div style="width: 60px; height: 2px; background: linear-gradient(to right, transparent, #C9A961, transparent); margin: 1rem auto;"></div>

            <div style="border: 3px double #8B4513; padding: 1.5rem; background: #fff; margin-bottom: 1.5rem;">
                <p style="font-size: 0.9rem; color: #5a4a3a; margin-bottom: 0.5rem;">This grant is issued to:</p>
                <p id="grantUserName" style="font-family: 'Cinzel', Georgia, serif; font-size: 1.3rem; color: #8B4513; font-weight: 700; margin-bottom: 1.25rem;">Pioneer</p>

                <p style="font-size: 0.8rem; color: #6b5a4a; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.25rem;">One-Time PASO Allocation</p>
                <p style="font-family: 'Cinzel', Georgia, serif; font-size: 2.5rem; color: #8B4513; font-weight: 900;">25 <span style="font-size: 1rem; color: #8B4513;">PASO</span></p>
            </div>

            <p style="font-size: 0.85rem; color: #4a3a2a; line-height: 1.6; margin-bottom: 1rem;">
                PASO is granted as recognition of your participation and belief in the El Paso Verse journey. It reflects your presence in the world-building process.
            </p>

            <p style="font-size: 0.8rem; color: #5a4a3a; font-style: italic; margin-bottom: 1.5rem;">
                PASO is not equity or ownership. Its value is rooted in participation and belonging.
            </p>

            <p style="font-size: 0.8rem; color: #5a4a3a; text-align: right; margin-bottom: 1.5rem;">
                — <strong>Harry West</strong>, on behalf of El Paso Verse
            </p>

            <button type="button" id="claimGrantButton" style="
                width: 100%;
                padding: 1rem 1.5rem;
                background: linear-gradient(to bottom, #8B4513, #6d3610);
                color: #F5E6D3;
                border: 2px solid #C9A961;
                font-family: 'Cinzel', Georgia, serif;
                font-size: 1rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            " onmouseover="this.style.background='linear-gradient(to bottom, #C9A961, #a8893e)'; this.style.color='#3A2820';" onmouseout="this.style.background='linear-gradient(to bottom, #8B4513, #6d3610)'; this.style.color='#F5E6D3';">
                Claim Grant & Enter Portal
            </button>
        </div>
    </div>

    <!-- Waiver Modal -->
    <div class="modal-overlay" id="waiverModal">
        <div class="modal" style="max-width: 700px; max-height: 90vh; display: flex; flex-direction: column;">
            <h2 style="font-family: 'Cinzel', Georgia, serif; font-size: 1.3rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem;">Participation Terms</h2>
            <p style="color: #8B4513; font-style: italic; margin-bottom: 1rem; font-size: 0.9rem;">Kamara / El Paso Verse – an Ind. Vision-Driven Creative Project</p>

            <div style="flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 1.25rem; background: #fff; font-size: 0.85rem; line-height: 1.7; margin-bottom: 1rem; max-height: 400px;">

                <!-- Section 1: Participation Intake Waiver -->
                <h3 style="font-family: 'Cinzel', Georgia, serif; font-size: 1.1rem; color: #3A2820; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid #C9A961;">Section 1: Standard Participation Intake Waiver</h3>

                <p><strong>READ CAREFULLY BEFORE PARTICIPATING</strong></p>
                <p>The undersigned ("Participant") acknowledges and agrees as follows:</p>

                <p><strong>1. Nature and Spirit of the Project</strong><br>
                This project forms part of the Kamara / El Paso Verse creative universe, an independent, long-term creative vision initiated and developed by Harry West, and sustained through the personal vision, goodwill, trust, and continued effort of its creator(s). The Participant acknowledges that this project would not exist but for the commitment and perseverance of its creator(s), that it is pioneering in spirit, carving its own path outside conventional production models, and that it is pursued against significant practical, financial, and structural obstacles, particularly in today's entertainment industry landscape. The project is developed on a best-efforts basis, with limited resources, progressive financing, and open-ended timelines, and may include films, short works, experimental productions, and related creative activities.</p>

                <p><strong>2. Risk, Uncertainty, and No Guarantees</strong><br>
                The Participant understands that development, financing, production, post-production, exploitation, and/or monetization may be delayed, paused, extended, or may not ultimately occur. No promises or guarantees have been made regarding funding, payment timing, completion, commercial success, distribution, or monetization. Participation is voluntary and undertaken with full awareness of these realities.</p>

                <p><strong>3. Rewards, Goodwill, and Voluntary Contributions</strong><br>
                Participation in the project may, but does not necessarily, give rise to recognition, opportunities, or future rewards. Any compensation, profit participation, ownership interest, credit, PASO allocation, or other benefit shall arise only if expressly set forth in a separate written agreement. No expectation of reward is implied by participation alone. Any assistance, contribution, service, resource, or support provided to the project is given voluntarily and in good faith, and shall be deemed gratuitous unless expressly agreed otherwise in a separate written contract.</p>

                <p><strong>4. Entity-Only Responsibility and Waiver of Claims</strong><br>
                Any contractual, financial, or labor obligations, if applicable, exist solely at the level of the producing entity, if any. The Participant agrees that no personal liability or recourse exists against any individual involved in the project, including the creator(s), director(s), producer(s), administrator(s), shareholder(s), or representatives, in their personal capacity. The Participant irrevocably waives any right to bring claims or proceedings—judicial or extrajudicial—against any such individual arising out of or related to participation in the project.</p>

                <p><strong>5. No Blocking Actions; Personal Circumstances</strong><br>
                Changes in the Participant's personal, financial, or emotional circumstances do not create any obligation on the project or its participants. The Participant agrees not to seek injunctive relief or any action intended to delay, block, or interfere with the project.</p>

                <p><strong>6. Legal Limits</strong><br>
                This waiver does not apply in cases of willful misconduct or fraud, solely to the extent finally determined by a competent court under applicable law.</p>

                <p><strong>7. Informed Consent and Welcome</strong><br>
                The Participant confirms that they have read and understood this document and consciously accept participation in a vision-driven, pioneering project operating within a challenging and uncertain industry environment.</p>

                <!-- Section 2: PASO Participation Grant -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 3px double #8B4513;"></div>
                <h3 style="font-family: 'Cinzel', Georgia, serif; font-size: 1.1rem; color: #3A2820; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid #C9A961;">Section 2: PASO Participation Grant</h3>

                <p>El Paso Verse is a long-term creative project built through filmmaking, world-building, and community participation, centered on a narrative world set in 1880. PASO exists to recognize early involvement and alignment as the project develops. This section confirms a PASO grant made in that spirit.</p>

                <p><strong>Purpose</strong><br>
                PASO is granted as recognition of participation, belief, and alignment with the El Paso Verse journey. It reflects presence in the world-building process and contribution to the shared vision over time.</p>

                <p><strong>PASO</strong><br>
                PASO is the native participation token of El Paso Verse. Its purpose, use cases, and evolution are described in the El Paso Verse VisionPaper, which serves as the canonical reference for the ecosystem. Within that context, PASO may be used for participation in the El Paso Verse world; access to experiences, initiatives, or future layers of the project; and community and governance functions as they emerge. PASO is not equity, ownership, or a claim on profits. Its value is rooted in participation and belonging, not guarantees.</p>

                <p><strong>Grant</strong><br>
                Grant amounts are determined using high-level participation logic as described in the VisionPaper, such as when someone joined the journey, how closely they have aligned with the vision, and their place within the evolving El Paso Verse ecosystem. This grant does not imply future grants. At the time PASO is issued as a digital token, the granted amount will be transferred to the digital wallet designated by the Recipient, in accordance with the technical implementation of the El Paso Verse ecosystem.</p>

                <p><strong>Liquidity &amp; Evolution</strong><br>
                PASO may evolve over time and may become transferable or tradable in the future, subject to the project's direction and applicable frameworks. No guarantee is made regarding liquidity, markets, or future value. PASO is granted for participation in a living project, not as a promise of financial outcome.</p>

                <p><strong>Acceptance</strong><br>
                By accepting this PASO grant, the Recipient acknowledges its purpose within the El Paso Verse vision, understands the scope of that vision as outlined in the published VisionPaper, and affirms their intention to engage with the ecosystem in good faith and in alignment with the spirit of the project.</p>
            </div>

            <button type="button" id="closeWaiverModal" style="
                width: 100%;
                padding: 0.875rem 1.5rem;
                background: linear-gradient(to bottom, #8B4513, #6d3610);
                color: #F5E6D3;
                border: 2px solid #C9A961;
                font-family: Georgia, 'Times New Roman', serif;
                font-size: 0.95rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            " onmouseover="this.style.background='linear-gradient(to bottom, #C9A961, #a8893e)'; this.style.color='#3A2820';" onmouseout="this.style.background='linear-gradient(to bottom, #8B4513, #6d3610)'; this.style.color='#F5E6D3';">I Understand</button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="modal">
            <h2>Reset Password</h2>
            <p>Enter your email address and we'll send you a link to reset your password.</p>

            <div class="message error" id="resetErrorMessage"></div>
            <div class="message success" id="resetSuccessMessage"></div>

            <form id="resetPasswordForm">
                <div class="form-group">
                    <label for="resetEmail">Email</label>
                    <input
                        type="email"
                        id="resetEmail"
                        name="email"
                        placeholder="Enter your email"
                        required
                        autocomplete="email"
                    >
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" id="cancelReset">Cancel</button>
                    <button type="submit" class="btn-primary" id="sendResetButton">Send Reset Link</button>
                </div>
            </form>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="auth.js?v=2"></script>
    <script src="sheet-logger.js"></script>
    <script src="points-system.js?v=2"></script>
    <script>
        // DOM Elements
        const signInTab = document.getElementById('signInTab');
        const signUpTab = document.getElementById('signUpTab');
        const signInForm = document.getElementById('signInForm');
        const signUpForm = document.getElementById('signUpForm');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const cancelReset = document.getElementById('cancelReset');
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const resetErrorMessage = document.getElementById('resetErrorMessage');
        const resetSuccessMessage = document.getElementById('resetSuccessMessage');

        // Waiver Modal
        const openWaiverLink = document.getElementById('openWaiverLink');
        const waiverModal = document.getElementById('waiverModal');
        const closeWaiverModal = document.getElementById('closeWaiverModal');

        openWaiverLink.addEventListener('click', (e) => {
            e.preventDefault();
            waiverModal.classList.add('show');
        });

        closeWaiverModal.addEventListener('click', () => {
            waiverModal.classList.remove('show');
        });

        waiverModal.addEventListener('click', (e) => {
            if (e.target === waiverModal) {
                waiverModal.classList.remove('show');
            }
        });

        // Check if already authenticated and redirect
        waitForAuthState().then(authenticated => {
            if (authenticated && auth.currentUser && auth.currentUser.emailVerified) {
                window.location.href = 'members.html';
            }
        });

        // Check URL params for verification pending
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('verify') === 'pending') {
            showError('Please verify your email before accessing the community. Check your inbox for the verification link.');
            document.getElementById('resendVerification').classList.remove('hidden');
        }

        // Check if redirected from email capture — auto-switch to Sign Up with email pre-filled
        if (urlParams.get('signup') === 'true') {
            signUpTab.classList.add('active');
            signInTab.classList.remove('active');
            signUpForm.classList.remove('hidden');
            signInForm.classList.add('hidden');

            const prefillEmail = urlParams.get('email');
            if (prefillEmail) {
                document.getElementById('signUpEmail').value = decodeURIComponent(prefillEmail);
            }

            showSuccess('Almost there! Set a password to claim your 25 PASO.');
        }

        // Tab switching
        signInTab.addEventListener('click', () => {
            signInTab.classList.add('active');
            signUpTab.classList.remove('active');
            signInForm.classList.remove('hidden');
            signUpForm.classList.add('hidden');
            hideMessages();
        });

        signUpTab.addEventListener('click', () => {
            signUpTab.classList.add('active');
            signInTab.classList.remove('active');
            signUpForm.classList.remove('hidden');
            signInForm.classList.add('hidden');
            hideMessages();
        });

        // Helper functions
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            successMessage.classList.remove('show');
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.classList.add('show');
            errorMessage.classList.remove('show');
        }

        function hideMessages() {
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');
        }

        function setButtonLoading(button, loading) {
            if (loading) {
                button.disabled = true;
                button.dataset.originalText = button.textContent;
                button.textContent = 'Please wait...';
            } else {
                button.disabled = false;
                button.textContent = button.dataset.originalText || button.textContent;
            }
        }

        // PASO Grant Modal
        const grantModal = document.getElementById('grantModal');
        const claimGrantButton = document.getElementById('claimGrantButton');

        function showGrantModal(email) {
            const displayName = email ? email.split('@')[0] : 'Pioneer';
            document.getElementById('grantUserName').textContent = displayName;
            grantModal.classList.add('show');
        }

        claimGrantButton.addEventListener('click', async () => {
            claimGrantButton.disabled = true;
            claimGrantButton.textContent = 'Processing...';

            // Record grant acceptance if user is authenticated
            try {
                if (auth.currentUser && db) {
                    await db.collection('users').doc(auth.currentUser.uid).update({
                        grantAccepted: true,
                        grantAcceptedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        onboardingCompleted: true
                    });
                }
            } catch (e) {
                console.log('Could not record grant acceptance:', e);
            }

            // Redirect to members portal
            window.location.href = 'members.html';
        });

        // Sign In Form Handler
        signInForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideMessages();

            const email = document.getElementById('signInEmail').value.trim();
            const password = document.getElementById('signInPassword').value;
            const submitButton = document.getElementById('signInButton');

            setButtonLoading(submitButton, true);

            const result = await signIn(email, password);

            if (result.success) {
                // Check if user has already claimed their grant
                try {
                    if (db && auth.currentUser) {
                        const userDoc = await db.collection('users').doc(auth.currentUser.uid).get();
                        if (userDoc.exists && userDoc.data().grantAccepted) {
                            // Already claimed, go to members
                            window.location.href = 'members.html';
                        } else {
                            // First time, show grant modal
                            showGrantModal(email);
                        }
                    } else {
                        window.location.href = 'members.html';
                    }
                } catch (e) {
                    console.log('Error checking grant status:', e);
                    window.location.href = 'members.html';
                }
            } else {
                showError(result.error);
                setButtonLoading(submitButton, false);
                if (result.needsVerification) {
                    document.getElementById('resendVerification').classList.remove('hidden');
                }
            }
        });

        // Sign Up Form Handler
        signUpForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideMessages();

            const email = document.getElementById('signUpEmail').value.trim();
            const password = document.getElementById('signUpPassword').value;
            const confirmPassword = document.getElementById('signUpConfirmPassword').value;
            const submitButton = document.getElementById('signUpButton');

            // Validate passwords match
            if (password !== confirmPassword) {
                showError('Passwords do not match. Please try again.');
                return;
            }

            setButtonLoading(submitButton, true);

            const result = await signUp(email, password);

            if (result.success) {
                if (result.needsVerification) {
                    showSuccess('Account created! Please check your email and click the verification link to continue.');
                    setButtonLoading(submitButton, false);
                    // Show resend option
                    document.getElementById('resendVerification').classList.remove('hidden');
                } else {
                    // Show PASO grant modal for new signups
                    showGrantModal(email);
                }
            } else {
                showError(result.error);
                setButtonLoading(submitButton, false);
            }
        });

        // Resend Verification Email
        document.getElementById('resendVerificationLink').addEventListener('click', async () => {
            const result = await resendVerificationEmail();
            if (result.success) {
                showSuccess('Verification email sent! Please check your inbox.');
            } else {
                showError(result.error);
            }
        });

        // Forgot Password Modal
        forgotPasswordLink.addEventListener('click', () => {
            forgotPasswordModal.classList.add('show');
            document.getElementById('resetEmail').value = document.getElementById('signInEmail').value;
            resetErrorMessage.classList.remove('show');
            resetSuccessMessage.classList.remove('show');
        });

        cancelReset.addEventListener('click', () => {
            forgotPasswordModal.classList.remove('show');
        });

        forgotPasswordModal.addEventListener('click', (e) => {
            if (e.target === forgotPasswordModal) {
                forgotPasswordModal.classList.remove('show');
            }
        });

        // Google Sign In Handler
        // Store pending Google result for after waiver acceptance
        let pendingGoogleResult = null;

        document.getElementById('googleSignInButton').addEventListener('click', async function() {
            hideMessages();
            const button = this;

            button.disabled = true;
            button.innerHTML = 'Please wait...';

            const result = await signInWithGoogle();

            if (result.success) {
                if (result.isNewUser) {
                    // New Google user — must accept waiver & PASO grant terms first
                    pendingGoogleResult = result;
                    waiverModal.classList.add('show');
                    // Change the waiver button to require acceptance
                    closeWaiverModal.textContent = 'I Accept';
                    closeWaiverModal.onclick = function() {
                        waiverModal.classList.remove('show');
                        closeWaiverModal.textContent = 'I Understand';
                        closeWaiverModal.onclick = function() { waiverModal.classList.remove('show'); };
                        // Now show the PASO grant modal
                        showGrantModal(auth.currentUser.email);
                    };
                } else {
                    // Returning Google user — check grant status
                    try {
                        if (db && auth.currentUser) {
                            const userDoc = await db.collection('users').doc(auth.currentUser.uid).get();
                            if (userDoc.exists && userDoc.data().grantAccepted) {
                                window.location.href = 'members.html';
                            } else {
                                showGrantModal(auth.currentUser.email);
                            }
                        } else {
                            window.location.href = 'members.html';
                        }
                    } catch (e) {
                        window.location.href = 'members.html';
                    }
                }
            } else {
                showError(result.error);
                button.disabled = false;
                button.innerHTML = `
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                `;
            }
        });

        // Reset Password Form Handler
        resetPasswordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            resetErrorMessage.classList.remove('show');
            resetSuccessMessage.classList.remove('show');

            const email = document.getElementById('resetEmail').value.trim();
            const submitButton = document.getElementById('sendResetButton');

            setButtonLoading(submitButton, true);

            const result = await sendPasswordReset(email);

            setButtonLoading(submitButton, false);

            if (result.success) {
                resetSuccessMessage.textContent = 'Password reset email sent! Check your inbox.';
                resetSuccessMessage.classList.add('show');
                setTimeout(() => {
                    forgotPasswordModal.classList.remove('show');
                }, 3000);
            } else {
                resetErrorMessage.textContent = result.error;
                resetErrorMessage.classList.add('show');
            }
        });
    </script>
</body>
</html>
